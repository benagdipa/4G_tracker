import{r as c,j as r,Y,a as y,d as T,y as j}from"./app-D-c2KTM-.js";import{S as q,E as G,C as Q,P as X}from"./ExportButton-uWdgeKao.js";import{T as Z}from"./TextInput-CpY_0_3r.js";import{A as ee,C as re}from"./AuthenticatedLayout-Cn63R9N-.js";import{r as x}from"./index-CF4m0Bsz.js";import{_ as N}from"./index-CgRyFf_U.js";import le from"./InputItemField-DQ8BYval.js";import E from"./DateItemField-BZ8bwlUi.js";import R from"./SelectItemField-8Y1HODef.js";import ae from"./UploadItemField-fCfqbf5C.js";import oe from"./CSVMapping-DHIhqy8X.js";import se from"./SaveBtn-BgMTJWMj.js";import"./createLucideIcon-j1Nja-rK.js";import"./transition-CosfxPmh.js";import"./floating-ui.dom-BJX5GPEt.js";import"./index-Iut5DvVo.js";import"./format-utaHABU8.js";import"./index-BVKetwGh.js";import"./InputLabel-D8CFEeqx.js";import"./InputError-VCVziB5R.js";function ke({auth:f,sites:t,get_data:l,batch:p}){var _;const{role:F}=f,W=[{name:"LOCID",sortable:!0,sortKey:"loc_id"},{name:"WNTD",sortable:!0,sortKey:"wntd"},{name:"IMSI",sortable:!0,sortKey:"imsi"},{name:"VERSION",sortable:!0,sortKey:"version"},{name:"AVC",sortable:!0,sortKey:"avc"},{name:"BW Profile",sortable:!0,sortKey:"bw_profile"},{name:"Lon",sortable:!0,sortKey:"lon"},{name:"Lat",sortable:!0,sortKey:"lat"},{name:"SiteName",sortable:!0,sortKey:"site_name"},{name:"HomeCell",sortable:!0,sortKey:"home_cell"},{name:"HomePCI",sortable:!0,sortKey:"home_pci"},{name:"Traffic Profile",sortable:!0,sortKey:"traffic_profile"},{name:"Start Date",sortable:!1,sortKey:"start_date"},{name:"End Date",sortable:!1,sortKey:"end_date"},{name:"Solution Type",sortable:!1,sortKey:"solution_type"},{name:"Status",sortable:!1,sortKey:"status"},{name:"Remarks",sortable:!1,sortKey:"remarks"},{name:"Artifacts",sortable:!1,sortKey:"artifacts"},{name:""}],g=c.useRef(null),[I,A]=c.useState(l!=null&&l.search?l==null?void 0:l.search:""),[w,z]=c.useState(l!=null&&l.per_page?l==null?void 0:l.per_page:10),[i]=c.useState(t),[B,C]=c.useState(!1),[V,J]=c.useState(""),[b,S]=c.useState(null),[k,v]=c.useState([]),U=e=>{g.current.click()},$=async e=>{var n,m,d;const s=new FormData;s.append("import_file",e.target.files[0]);try{const a=await T.post(route("wireless.sites.import"),s);a!=null&&a.data&&(J(a==null?void 0:a.data),C(!0))}catch(a){N.error(`${(d=(m=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:m.error)==null?void 0:d.message}`)}},L=async()=>{j.get(route("wireless.sites.index",{search:I}))},D=async(e,s)=>{j.get(route("wireless.sites.index",{order_by:e,order:s}))},u=(e,s)=>{var n;if(e)return(n=e[s])==null?void 0:n.value},K=async(e,s)=>{j.get(route("wireless.sites.index",{filter_by:e,value:s}))},M=e=>{z(e),j.get(route("wireless.sites.index",{...l,per_page:e}))};c.useEffect(()=>{p!=null&&p.batch_site_id&&S(p==null?void 0:p.batch_site_id)},[]),c.useEffect(()=>{const e=async()=>{var n,m,d;try{let a=0;const o=await T.get(route("import.progress",{batchId:b}));if(o!=null&&o.data){let P=parseInt((n=o==null?void 0:o.data)==null?void 0:n.total_jobs),H=parseInt((m=o==null?void 0:o.data)==null?void 0:m.pending_jobs),O=P-H;parseInt((d=o==null?void 0:o.data)==null?void 0:d.failed_jobs)>0?clearInterval(s):(a=parseInt(O/P*100).toFixed(0),a<100?N.loading(`CSV Data Import Progress: ${a}%.
 Please wait....`,{id:"loading-toast",style:{backgroundColor:"#424242",color:"#ffffff",fontSize:14,borderRadius:4,fontWeight:"bold"}}):(N.dismiss("loading-toast"),clearInterval(s)))}}catch(a){console.log(a)}},s=setInterval(()=>{b&&e()},1e3);return()=>clearInterval(s)},[b]);const h=(e,s,n,m)=>{const d=k.findIndex(a=>a.site_id===e&&a.loc_id===s);v(d!==-1?a=>{const o=[...a];return o[d]={...o[d],items:{...o[d].items,[n]:m}},o}:a=>[...a,{site_id:e,loc_id:s,items:{[n]:m}}])};return r.jsxs(ee,{user:f==null?void 0:f.user,children:[r.jsx(Y,{title:"Wireless Sites"}),r.jsx("div",{className:"top-section p-4",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"",children:[r.jsx(x.Typography,{variant:"h3",className:"tracking-tight",children:"WNTD"}),r.jsxs("ul",{className:"flex gap-1 text-gray-600 text-sm",children:[r.jsx("li",{children:r.jsx(y,{href:route("dashboard"),children:"Dashboard"})}),r.jsx("li",{children:"/"}),r.jsx("li",{children:r.jsx(y,{href:route("wireless.sites.index"),children:"WNTD"})})]})]})})}),r.jsx("div",{className:"filter-wrapper md:px-4",children:r.jsxs("div",{className:"flex filter-details justify-end gap-3",children:[r.jsxs("div",{className:"search-wrapper w-1/3 flex relative",children:[r.jsx(Z,{placeholder:"Search...",className:"w-full text-sm rounded-md rounded-r-none border-r-0 focus:ring-0 h-8",value:I,onChange:e=>A(e.target.value)}),r.jsx("div",{className:"search-icon",children:r.jsx(x.IconButton,{size:"sm",className:"rounded-l-none",onClick:L,children:r.jsx(q,{color:"white",size:18})})})]}),r.jsx("div",{className:"status-filter",children:r.jsxs("select",{className:"w-52 text-sm rounded-md focus:ring-0 h-8 border-gray-300 py-1 text-gray-600 font-medium",onChange:e=>K("status",e.target.value),value:(l==null?void 0:l.filter_by)==="status"?l==null?void 0:l.value:"",children:[r.jsx("option",{value:"",children:"Filter by Status"}),r.jsx("option",{value:"in_progress",children:"In Progress"}),r.jsx("option",{value:"not_started",children:"Not Started"}),r.jsx("option",{value:"completed",children:"Completed"})]})}),r.jsx("div",{className:"filter-solution-type",children:r.jsxs("select",{className:"w-52 text-sm rounded-md focus:ring-0 h-8 border-gray-300 py-1 text-gray-600 font-medium",onChange:e=>K("solution_type",e.target.value),value:(l==null?void 0:l.filter_by)==="solution_type"?l==null?void 0:l.value:"",children:[r.jsx("option",{value:"",children:"Filter by Solution Type"}),r.jsx("option",{value:"device_upgrade",children:"Device Upgrade"}),r.jsx("option",{value:"reparent",children:"Reparent"}),r.jsx("option",{value:"repan",children:"Repan"})]})}),F==="super-admin"&&r.jsxs("div",{className:"import-type-field",children:[r.jsx(x.Button,{variant:"gradient",className:"capitalize",size:"sm",onClick:U,children:"Import from CSV"}),r.jsx("input",{type:"file",onChange:$,ref:g,style:{display:"none"}})]}),r.jsx(G,{route_name:"wireless.sites.export",file_name:"WNTD_Export"})]})}),r.jsxs("div",{className:"content mt-6",children:[r.jsx(x.Card,{className:"h-full w-full rounded-none",children:r.jsxs("div",{className:"overflow-x-auto overflow-hidden",children:[r.jsxs("table",{className:"w-full table-auto",children:[r.jsx("thead",{children:r.jsx("tr",{children:W.map(e=>r.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-2 border-l cursor-pointer",children:r.jsxs("div",{className:"flex justify-between",children:[r.jsx(x.Typography,{variant:"small",className:"leading-none text-gray-800 font-medium text-sm",children:e.name}),(e==null?void 0:e.sortable)&&r.jsxs("div",{className:"relative mt-1",children:[r.jsx("span",{className:"absolute -top-2 right-0 hover:bg-blue-gray-100 rounded-sm",children:r.jsx(Q,{size:12,strokeWidth:2,onClick:()=>{D(e.sortKey,"asc")}})}),r.jsx("span",{className:"absolute -bottom-1 right-0 hover:bg-blue-gray-100 rounded-sm",children:r.jsx(re,{size:12,strokeWidth:2,onClick:()=>{D(e.sortKey,"desc")}})})]})]})},e.name))})}),r.jsx("tbody",{children:i==null?void 0:i.data.map((e,s)=>r.jsxs("tr",{className:"even:bg-blue-gray-50/50",children:[r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:r.jsx(y,{href:route("wireless.show.location.index",e==null?void 0:e.loc_id),className:"font-semibold underline",children:e==null?void 0:e.loc_id})}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.wntd}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.imsi}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.version}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.avc}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.bw_profile}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2 w-20",children:e==null?void 0:e.lon}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2 w-20",children:e==null?void 0:e.lat}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.site_name}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.home_cell}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.home_pci}),r.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2",children:e==null?void 0:e.traffic_profile}),r.jsx("td",{className:"border-l h-10",children:r.jsx(E,{value:u(e==null?void 0:e.tracking,"start_date"),name:"start_date",locId:e.loc_id,siteId:e.id,handleEditAbleItem:h})}),r.jsx("td",{className:"border-l h-10",children:r.jsx(E,{value:u(e==null?void 0:e.tracking,"end_date"),name:"end_date",locId:e.loc_id,siteId:e.id,handleEditAbleItem:h})}),r.jsx("td",{className:"border-l h-10",children:r.jsx(R,{value:u(e==null?void 0:e.tracking,"solution_type"),name:"solution_type",locId:e.loc_id,siteId:e.id,handleEditAbleItem:h,options:[{label:"Device Upgrade",value:"device_upgrade"},{label:"Reparent",value:"reparent"},{label:"Repan",value:"repan"}]})}),r.jsx("td",{className:"border-l h-10",children:r.jsx(R,{value:u(e==null?void 0:e.tracking,"status"),name:"status",locId:e.loc_id,siteId:e.id,handleEditAbleItem:h,options:[{label:"In Progress",value:"in_progress"},{label:"Not Started",value:"not_started"},{label:"Completed",value:"completed"}]})}),r.jsx("td",{className:"border-l h-10",children:r.jsx(le,{value:u(e==null?void 0:e.tracking,"remarks"),name:"remarks",locId:e.loc_id,siteId:e.id,handleEditAbleItem:h})}),r.jsx("td",{className:"border-l h-10",children:r.jsx(ae,{value:u(e==null?void 0:e.tracking,"artifacts"),name:"artifacts",locId:e.loc_id,siteId:e.id})}),r.jsx("td",{className:"border-l h-10 px-3",children:r.jsx(se,{site_id:e==null?void 0:e.id,changedItems:k,setChangedItems:v})})]},e.id))})]}),((_=i==null?void 0:i.data)==null?void 0:_.length)===0&&r.jsx(x.Typography,{variant:"h6",color:"blue-gray",className:"text-center py-6",children:"No data found"}),r.jsxs("div",{className:"md:flex grid justify-start md:justify-end items-center pt-6 mb-8 gap-3 px-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Rows per Page"}),r.jsxs("select",{className:"rounded-md text-sm font-medium border-gray-400 focus:ring-0 py-2",value:w,onChange:e=>{M(e.target.value)},children:[r.jsx("option",{value:"10",children:"10"}),r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"20",children:"20"}),r.jsx("option",{value:"20",children:"25"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]})]}),r.jsx("div",{className:"text-sm font-medium",children:`${t==null?void 0:t.from}-${t==null?void 0:t.to} of ${t==null?void 0:t.total} Records`}),r.jsx(X,{links:i==null?void 0:i.links,perPage:w})]})]})}),r.jsx(oe,{mappingDialog:B,setMappingDialog:C,mappingData:V,setBatchId:S})]})]})}export{ke as default};
