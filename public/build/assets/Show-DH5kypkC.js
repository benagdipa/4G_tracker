import{r as T,W as M,j as e,R as y,q as S,Y}from"./app-K7whChZx.js";import{I as N}from"./InputError-CExbIU8R.js";import{I}from"./InputLabel-CL4DvoKe.js";import{T as H}from"./TextInput-CjeB6rnE.js";import{r as i}from"./index-D_SS0Q7D.js";import{t as u,c as P,u as W,x as U,z as V,k as R,j as C,B as O,C as v,g as _,y as $,p as q,A as G}from"./index-Bevc7GHM.js";import{c as J}from"./createLucideIcon-CNQCRz2q.js";import{P as K}from"./PageLayout-BXu4-1yu.js";import{X as Q}from"./x-7t4cwNqR.js";import"./ApplicationLogo-CiuKq79F.js";/**
 * @license lucide-react v0.376.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=J("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function D(t,n){const r=u(t),c=u(n),s=r.getTime()-c.getTime();return s<0?-1:s>0?1:s}function ee(t){return P(t,Date.now())}function te(t){return n=>{const c=(t?Math[t]:Math.trunc)(n);return c===0?0:c}}function ae(t,n){return+u(t)-+u(n)}function se(t){const n=u(t);return+W(n)==+U(n)}function re(t,n){const r=u(t),c=u(n),s=D(r,c),d=Math.abs(V(r,c));let m;if(d<1)m=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*d);let o=D(r,c)===-s;se(u(t))&&d===1&&D(t,c)===1&&(o=!1),m=s*(d-Number(o))}return m===0?0:m}function ne(t,n,r){const c=ae(t,n)/1e3;return te(r==null?void 0:r.roundingMethod)(c)}function oe(t,n,r){const c=_(),s=(r==null?void 0:r.locale)??c.locale??R,d=2520,m=D(t,n);if(isNaN(m))throw new RangeError("Invalid time value");const o=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:m});let x,h;m>0?(x=u(n),h=u(t)):(x=u(t),h=u(n));const g=ne(h,x),j=(C(h)-C(x))/1e3,l=Math.round((g-j)/60);let p;if(l<2)return r!=null&&r.includeSeconds?g<5?s.formatDistance("lessThanXSeconds",5,o):g<10?s.formatDistance("lessThanXSeconds",10,o):g<20?s.formatDistance("lessThanXSeconds",20,o):g<40?s.formatDistance("halfAMinute",0,o):g<60?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",1,o):l===0?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",l,o);if(l<45)return s.formatDistance("xMinutes",l,o);if(l<90)return s.formatDistance("aboutXHours",1,o);if(l<O){const f=Math.round(l/60);return s.formatDistance("aboutXHours",f,o)}else{if(l<d)return s.formatDistance("xDays",1,o);if(l<v){const f=Math.round(l/O);return s.formatDistance("xDays",f,o)}else if(l<v*2)return p=Math.round(l/v),s.formatDistance("aboutXMonths",p,o)}if(p=re(h,x),p<12){const f=Math.round(l/v);return s.formatDistance("xMonths",f,o)}else{const f=p%12,b=Math.trunc(p/12);return f<3?s.formatDistance("aboutXYears",b,o):f<9?s.formatDistance("overXYears",b,o):s.formatDistance("almostXYears",b+1,o)}}function ce(t,n){return oe(t,ee(t),n)}function z(t,n,r){var j,l;const c=u(t),s=u(n),d=_(),m=d.locale??R,o=d.weekStartsOn??((l=(j=d.locale)==null?void 0:j.options)==null?void 0:l.weekStartsOn)??0,x=$(c,s);if(isNaN(x))throw new RangeError("Invalid time value");let h;x<-6?h="other":x<-1?h="lastWeek":x<0?h="yesterday":x<1?h="today":x<2?h="tomorrow":x<7?h="nextWeek":h="other";const g=m.formatRelative(h,c,s,{locale:m,weekStartsOn:o});return q(c,g,{locale:m,weekStartsOn:o})}function X({commentId:t,parentId:n=0,userId:r}){const[c,s]=T.useState(!1),d=()=>s(f=>!f),{data:m,setData:o,post:x,processing:h,errors:g,reset:j,delete:l}=M({comment_id:t,parent_id:n,body:""}),p=f=>{f.preventDefault(),x(route("issues.reply.store"),{preserveScroll:!0,onSuccess:()=>{j(),s(!1)}})};return e.jsxs(y.Fragment,{children:[e.jsx("button",{className:"px-0 capitalize text-gray-500 font-normal text-sm",onClick:d,children:"Reply"}),e.jsx(i.Collapse,{open:c,children:e.jsxs("form",{className:"mt-3",children:[e.jsxs("div",{className:"form-item mb-4",children:[e.jsx("textarea",{className:"w-full font-normal text-gray-700 border-gray-300 rounded-md shadow-sm focus:ring-0 focus:border-gray-500 text-sm",placeholder:"Your Reply...",rows:4,value:m.body,onChange:f=>o("body",f.target.value)}),e.jsx(N,{message:g.body,className:"mt-2"})]}),e.jsxs("div",{className:"form-item mb-4 text-right",children:[e.jsx(i.Button,{variant:"text",color:"red",onClick:d,className:"mr-1",children:e.jsx("span",{children:"Cancel"})}),e.jsx(i.Button,{variant:"gradient",color:"green",size:"sm",loading:h,onClick:p,children:e.jsx("span",{children:"Reply"})})]})]})})]})}function A({type:t,itemId:n}){const r=()=>{};return e.jsx("div",{children:e.jsx("div",{className:"icon absolute right-0 top-2",children:e.jsxs(i.Menu,{children:[e.jsx(i.MenuHandler,{children:e.jsx(Z,{size:20,color:"gray",strokeWidth:1.5,className:"cursor-pointer"})}),e.jsxs(i.MenuList,{children:[e.jsx(i.MenuItem,{children:"Edit"}),e.jsx(i.MenuItem,{onClick:r,children:"Delete"})]})]})})})}function B({reply:t,commentId:n}){var c,s,d,m,o;const{user:r}=(c=S().props)==null?void 0:c.auth;return e.jsxs("li",{className:"font-normal text-base text-blue-gray-900 mb-4 relative",children:[e.jsx("span",{className:"block w-6 h-1 border-b border-gray-200 absolute left-0 top-[7px]"}),e.jsxs("div",{className:"ms-6 reply-container relative border p-2 rounded-md border-gray-200",children:[e.jsxs("div",{className:"text-gray-500 font-medium block text-[13px]",children:["@",(s=t==null?void 0:t.user)==null?void 0:s.name," - ",e.jsx("span",{className:"capitalize",children:z(new Date(t==null?void 0:t.created_at),new Date)})]}),e.jsx("div",{className:"font-normal text-blue-gray-900",children:t==null?void 0:t.body}),e.jsx(X,{commentId:n,parentId:t==null?void 0:t.id,userId:(d=t==null?void 0:t.user)==null?void 0:d.id}),(r==null?void 0:r.id)===((m=t==null?void 0:t.user)==null?void 0:m.id)&&e.jsx(A,{type:"reply",itemId:t==null?void 0:t.id})]}),((o=t==null?void 0:t.replies)==null?void 0:o.length)>0&&e.jsx("ul",{className:"border-l border-gray-200 pt-4 ms-6 -mt-1",children:t==null?void 0:t.replies.map((x,h)=>e.jsx(B,{reply:x,commentId:n},h))})]})}function le({comment:t}){var r,c,s;const{user:n}=(r=S().props)==null?void 0:r.auth;return e.jsxs("div",{className:"py-4 border-t px-6",children:[e.jsxs("div",{className:"comment-container relative border p-2 rounded-md border-gray-200",children:[e.jsxs("div",{className:"text-gray-500 font-medium block text-[13px]",children:["@",t==null?void 0:t.user.name," - ",e.jsx("span",{className:"capitalize",children:z(new Date(t==null?void 0:t.created_at),new Date)})]}),e.jsx("div",{className:"font-normal text-blue-gray-900",children:t==null?void 0:t.comment_content}),e.jsx(X,{commentId:t==null?void 0:t.id,userId:(c=t==null?void 0:t.user)==null?void 0:c.id}),(n==null?void 0:n.id)===((s=t==null?void 0:t.user)==null?void 0:s.id)&&e.jsx(A,{type:"comment",itemId:t==null?void 0:t.id})]}),(t==null?void 0:t.replies.length)>0&&e.jsx("ul",{className:"border-l border-gray-200 pt-4 -mt-1",children:t==null?void 0:t.replies.map((d,m)=>e.jsx(B,{reply:d,commentId:t==null?void 0:t.id},m))})]})}function ie({issueId:t}){const[n,r]=T.useState(!1),c=()=>r(l=>!l),{data:s,setData:d,post:m,processing:o,errors:x,reset:h,delete:g}=M({issue_id:t,comment_content:""}),j=l=>{l.preventDefault(),m(route("issues.comment.store"),{preserveScroll:!0,onSuccess:()=>{h(),r(!1)}})};return e.jsxs("div",{className:"mt-3",children:[e.jsx(i.Typography,{onClick:c,className:"font-medium text-sm text-gray-500 w-max cursor-pointer",children:"Add a comment"}),e.jsx(i.Collapse,{open:n,children:e.jsxs("form",{className:"mt-3",children:[e.jsxs("div",{className:"form-item mb-4",children:[e.jsx("textarea",{className:"w-full font-normal text-gray-700 border-gray-300 rounded-md shadow-sm focus:ring-0 focus:border-gray-500",placeholder:"Your Comment...",rows:6,value:s.comment_content,onChange:l=>d("comment_content",l.target.value)}),e.jsx(N,{message:x.comment_content,className:"mt-2"})]}),e.jsxs("div",{className:"form-item mb-4 text-right",children:[e.jsx(i.Button,{variant:"text",color:"red",onClick:c,className:"mr-1",children:e.jsx("span",{children:"Cancel"})}),e.jsx(i.Button,{variant:"gradient",color:"green",loading:o,onClick:j,children:e.jsx("span",{children:"Submit"})})]})]})})]})}function Ne(){var k;const{site:t,issues:n}=S().props,[r,c]=y.useState(!1),{data:s,setData:d,post:m,processing:o,errors:x,reset:h,delete:g}=M({title:"",description:"",attachments:"",site_id:t==null?void 0:t.id,status:"open"}),j=()=>c(!r),{acceptedFiles:l,getRootProps:p,getInputProps:f}=G({accept:{"image/*":[]},maxFiles:1,onDrop:a=>{d("attachments",[...s==null?void 0:s.attachments,...a.map(w=>Object.assign(w,{preview:URL.createObjectURL(w)}))])}}),b=l.map(a=>e.jsxs("li",{children:[a.path," - ",a.size," bytes"]},a.path)),F=a=>{a.preventDefault(),m(route("issues.store"),{preserveScroll:!0,onSuccess:()=>{h(),c(!1)}})};return e.jsxs(K,{children:[e.jsx(Y,{title:"Site"}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"container mx-auto py-12",children:[e.jsxs("div",{className:"flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"left relative",children:[e.jsx(i.Chip,{value:t==null?void 0:t.status,color:(t==null?void 0:t.status)==="active"?"green":"red",className:"w-max"}),e.jsx(i.Typography,{variant:"h1",color:"blue-gray",className:"font-bold",children:t.name}),e.jsx(i.Typography,{className:"font-normal text-gray-500 text-lg",children:`${t==null?void 0:t.location.name}, ${(k=t==null?void 0:t.location)==null?void 0:k.address}`})]}),e.jsx("div",{className:"right",children:e.jsx(i.Button,{onClick:j,variant:"gradient",children:"Add Issue"})})]}),e.jsx("div",{className:"py-6",children:n.length>0&&n.map((a,w)=>e.jsx(y.Fragment,{children:e.jsx("div",{className:"issue-wrapper border mb-4 py-3 px-6 rounded-md",children:e.jsxs("div",{className:"issue-content",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(i.Typography,{variant:"h4",className:"font-bold tracking-tight",children:a==null?void 0:a.title}),e.jsx(i.Chip,{size:"sm",value:a==null?void 0:a.status,color:(a==null?void 0:a.status)==="open"?"green":"red",className:"w-max"})]}),e.jsxs(i.Typography,{className:"font-normal text-sm text-gray-600",children:[" ",a==null?void 0:a.user.name," | ",ce(new Date(a==null?void 0:a.created_at),{addSuffix:!0})]})]}),e.jsx(i.Typography,{className:"font-normal pt-2 text-sm",color:"blue-gray",children:a==null?void 0:a.description}),(a==null?void 0:a.attachments)&&e.jsx("div",{className:"mt-3 bg-gray-100 w-max rounded-md",children:e.jsx("img",{src:a==null?void 0:a.attachments,className:"w-24 h-24 object-cover rounded-md"})}),(a==null?void 0:a.comments.length)>0&&e.jsxs("div",{className:"comments-wrapper mt-6 border rounded py-3",children:[e.jsx(i.Typography,{variant:"h5",className:"tracking-tight mb-3 px-4",children:"Comments"}),a==null?void 0:a.comments.map((L,E)=>e.jsx(y.Fragment,{children:e.jsx(le,{comment:L})},E))]}),(a==null?void 0:a.status)==="open"&&e.jsx(ie,{issueId:a==null?void 0:a.id})]})})},a.id))})]})}),e.jsxs(i.Dialog,{open:r,handler:j,size:"xs",children:[e.jsxs(i.DialogHeader,{className:"justify-between",children:[e.jsx(i.Typography,{variant:"h3",className:"tracking-tighter",children:"Add Issue"}),e.jsx(i.IconButton,{size:"sm",variant:"text",onClick:j,children:e.jsx(Q,{})})]}),e.jsx(i.DialogBody,{children:e.jsxs("form",{children:[e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(I,{value:"Title",className:"mb-2"}),e.jsx(H,{className:"w-full font-normal text-gray-700",placeholder:"Title...",value:s.title,onChange:a=>d("title",a.target.value)}),e.jsx(N,{message:x.title,className:"mt-2"})]}),e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(I,{value:"Description",className:"mb-2"}),e.jsx("textarea",{className:"w-full font-normal text-gray-700 border-gray-300 rounded-md shadow-sm",placeholder:"Description...",rows:6,value:s.description,onChange:a=>d("description",a.target.value)}),e.jsx(N,{message:x.description,className:"mt-2"})]}),e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(I,{value:"Image",className:"mb-2"}),e.jsxs("div",{children:[e.jsxs("div",{...p({className:"dropzone"}),className:"border-2 border-gray-300 border-dashed rounded-md text-center py-16",children:[e.jsx("input",{...f()}),e.jsx("p",{children:"Drag 'n' drop some files here, or click to select files"})]}),l.length>0&&e.jsxs("aside",{className:"mt-2",children:[e.jsx("h4",{children:"Files"}),e.jsx("ul",{className:"text-sm text-black font-normal font-poppins",children:b})]})]}),e.jsx(N,{message:x.attachments,className:"mt-2"})]}),e.jsx("div",{className:"form-item mb-4",children:e.jsx("div",{className:"text-right",children:e.jsx(i.Button,{variant:"gradient",color:"green",loading:o,onClick:F,children:e.jsx("span",{children:"Submit"})})})})]})})]})]})}export{Ne as default};
