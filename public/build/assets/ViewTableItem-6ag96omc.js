import{q as y,r as N,j as e,R as F,y as V,W as D,Y as A,a as E}from"./app-9Xx7uxZX.js";import{_ as W,A as $,C as L}from"./AuthenticatedLayout-rxxwe8ok.js";import{r}from"./index-_S3y8LLf.js";import{T as _}from"./TextInput-DmDTERgO.js";import{I as H}from"./InputLabel-dNx04VCm.js";import{I as M}from"./InputError-nGMjMN_x.js";import{M as q,S as U,C as J}from"./search-KaaZxcix.js";import"./transition-DIoRP3Tk.js";function Y({mappingDialog:d,setMappingDialog:s,columns:t,mappingData:l}){const{id:i,slug:h}=y().props.entity,b=t==null?void 0:t.reduce((u,C)=>(u[C.slug]="",u),{}),[o,x]=N.useState({...b,file_path:l?l==null?void 0:l.filePath:"",entity_id:i}),[m,g]=N.useState({}),[a,c]=N.useState(!1),[n,v]=N.useState(""),[j,w]=N.useState(""),O=()=>s(!d),p=(u,C)=>{x(S=>({...S,[u]:C}))};N.useEffect(()=>{p("file_path",l!=null&&l.filePath?l==null?void 0:l.filePath:"")},[l]);const I=async u=>{var S,k,z,B,T;u.preventDefault();let C={};if(Object.keys(o).forEach(f=>{o[f]||(C[f]="This field is required.")}),g(C),Object.keys(C).length>0){console.log(C);return}try{c(!0);const f=await axios.post(route("table.map.save"),o);f!=null&&f.data&&(w((k=(S=f==null?void 0:f.data)==null?void 0:S.success)==null?void 0:k.message),setTimeout(()=>{s(!1),w(""),v("")},3e3),V.visit(route("view.table.item",h)))}catch(f){console.log("error:",f),v(`${(T=(B=(z=f==null?void 0:f.response)==null?void 0:z.data)==null?void 0:B.error)==null?void 0:T.message}`)}finally{c(!1)}};return e.jsx(F.Fragment,{children:e.jsxs(r.Dialog,{open:d,size:"xs",children:[e.jsx(r.DialogHeader,{children:"CSV Mapping"}),e.jsx(r.DialogBody,{className:"px-6 overflow-scroll",children:(t==null?void 0:t.length)>0&&(t==null?void 0:t.map((u,C)=>{var S;return e.jsx("div",{className:"form-item mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{value:u==null?void 0:u.name,className:"w-1/3"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("select",{className:"w-full font-medium text-[12px] py-1 rounded-md border-gray-300",value:o[u==null?void 0:u.slug],onChange:k=>p(u==null?void 0:u.slug,k.target.value),children:[e.jsx("option",{value:"",children:"Select"}),((S=l==null?void 0:l.header)==null?void 0:S.length)>0&&(l==null?void 0:l.header.map((k,z)=>e.jsx("option",{value:k,children:k},z)))]}),e.jsx(M,{message:m[u==null?void 0:u.slug],className:"!text-[12px] font-medium mt-1"})]})]})},C)}))}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:O,className:"mr-1 capitalize",disabled:a,children:e.jsx("span",{children:"Cancel"})}),e.jsx(r.Button,{variant:"gradient",color:"green",className:"capitalize",onClick:I,loading:a,children:e.jsx("span",{children:"Confirm"})})]})]})})}function G({columns:d}){const s=N.useRef(null),[t,l]=N.useState(!1),[i,h]=N.useState(""),b=x=>{s.current.click()},o=async x=>{var g,a,c;const m=new FormData;m.append("import_file",x.target.files[0]);try{const n=await axios.post(route("table.import.csv"),m);n!=null&&n.data&&(h(n==null?void 0:n.data),l(!0))}catch(n){W.error(`${(c=(a=(g=n==null?void 0:n.response)==null?void 0:g.data)==null?void 0:a.error)==null?void 0:c.message}`)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"import-type-field",children:[e.jsx(r.Button,{variant:"gradient",className:"capitalize",size:"sm",onClick:b,children:"Import from CSV"}),e.jsx("input",{type:"file",onChange:o,ref:s,style:{display:"none"}})]}),e.jsx(Y,{mappingDialog:t,setMappingDialog:l,mappingData:i,columns:d})]})}function K({addColumnDialog:d,setAddColumnDialog:s}){var g;const{id:t}=(g=y().props)==null?void 0:g.entity,{data:l,setData:i,post:h,processing:b,errors:o,reset:x}=D({entity_id:t,name:"",slug:"",sortable:!1,editable:!1,input_type:"",options:""}),m=a=>{a.preventDefault(),h(route("table.add.column"),{onSuccess:()=>{s(!1),x()}})};return e.jsxs(r.Dialog,{open:d,size:"xs",children:[e.jsx(r.DialogHeader,{children:"Add New Column"}),e.jsxs(r.DialogBody,{children:[e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(H,{value:"Column Name",className:"mb-1"}),e.jsx(_,{className:"w-full text-sm font-medium text-gray-600",placeholder:"Column Name...",value:l.name,onChange:a=>i("name",a.target.value)}),e.jsx(M,{message:o.name,className:"text-sm font-medium"})]}),e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(H,{value:"Column Slug",className:"mb-1"}),e.jsx(_,{className:"w-full text-sm font-medium text-gray-600",placeholder:"Column slug...",value:l.slug,onChange:a=>i("slug",a.target.value)}),e.jsx(M,{message:o.slug,className:"text-sm font-medium"})]}),e.jsx("div",{className:"form-item",children:e.jsx(r.Checkbox,{label:e.jsx(r.Typography,{className:"text-sm font-medium pl-2",children:"Sortable"}),defaultChecked:l.sortable,onChange:a=>i("sortable",a.target.checked)})}),e.jsx("div",{className:"form-item",children:e.jsx(r.Checkbox,{label:e.jsx(r.Typography,{className:"text-sm font-medium pl-2",children:"Editable"}),defaultChecked:l.editable,onChange:a=>i("editable",a.target.checked)})}),(l==null?void 0:l.editable)&&e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(H,{value:"Column Input Type",className:"mb-1"}),e.jsxs("select",{className:"w-full rounded text-sm border-gray-300 shadow-sm font-medium text-gray-600 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600",value:l.input_type,onChange:a=>i("input_type",a.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"dropdown",children:"DropDown"})]}),e.jsx(M,{message:o.input_type,className:"text-sm font-medium"})]}),(l==null?void 0:l.input_type)==="dropdown"&&e.jsxs("div",{className:"form-item mb-4",children:[e.jsx(H,{value:"Dropdown Options seprated by (|)",className:"mb-1"}),e.jsx("textarea",{className:"w-full rounded text-sm border-gray-300 shadow-sm font-normal focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600",placeholder:"Dropdown Options seprated by | ...",rows:4,value:l.options,onChange:a=>i("options",a.target.value)}),e.jsx(M,{message:o.options,className:"text-sm font-medium"})]})]}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:()=>s(!d),className:"mr-1 capitalize",children:e.jsx("span",{children:"Cancel"})}),e.jsx(r.Button,{variant:"gradient",color:"green",onClick:a=>m(a),className:"capitalize",loading:b,children:e.jsx("span",{children:"Submit"})})]})]})}function Q({hideColumnDialog:d,setHideColumnDialog:s,columns:t}){const l=()=>s(!d),{data:i,setData:h,post:b,processing:o,errors:x,reset:m}=D({items:[],unHiddenItems:[]}),g=c=>{const{value:n,checked:v}=c.target;v?(h(j=>({...j,items:[...j.items,parseInt(n)]})),h(j=>({...j,unHiddenItems:j.unHiddenItems.filter(w=>w!==parseInt(n))}))):(h(j=>({...j,items:j.items.filter(w=>w!==parseInt(n))})),h(j=>({...j,unHiddenItems:[...j.unHiddenItems,parseInt(n)]})))},a=c=>{c.preventDefault(),b(route("table.hide.column"),{onSuccess:()=>{s(!1),m()}})};return e.jsx(e.Fragment,{children:e.jsxs(r.Dialog,{open:d,size:"xs",children:[e.jsx(r.DialogHeader,{children:"Hide Column"}),e.jsx(r.DialogBody,{children:e.jsxs("div",{className:"form-item",children:[e.jsx("p",{className:"text-[#333] font-semibold",children:"Please select the column you want to hide"}),e.jsx("div",{className:"form-item grid grid-cols-2",children:(t==null?void 0:t.length)>0&&t.map((c,n)=>e.jsx(F.Fragment,{children:e.jsx(r.Checkbox,{label:e.jsx(r.Typography,{color:"blue-gray",className:"font-medium text-sm",children:c==null?void 0:c.name}),value:c==null?void 0:c.id,onChange:v=>g(v),defaultChecked:c==null?void 0:c.hidden})},n))})]})}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:l,className:"mr-1 capitalize",children:e.jsx("span",{children:"Cancel"})}),e.jsx(r.Button,{variant:"gradient",color:"green",className:"capitalize",onClick:c=>{a(c)},loading:o,children:e.jsx("span",{children:"Confirm"})})]})]})})}function X({renameColumnDialog:d,setRenameColumnDialog:s,columns:t}){var a,c;const{data:l,setData:i,post:h,processing:b,errors:o,reset:x}=D({items:t}),m=(n,v)=>{i(j=>({...j,items:j.items.map(w=>w.slug===n?{...w,name:v}:w)}))},g=n=>{n.preventDefault(),h(route("table.rename.column"),{onSuccess:()=>{s(!1),x()}})};return e.jsxs(r.Dialog,{open:d,size:"xs",children:[e.jsx(r.DialogHeader,{children:"Rename Columns"}),e.jsx(r.DialogBody,{className:"max-h-[42rem] overflow-scroll",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:((a=l==null?void 0:l.items)==null?void 0:a.length)>0&&((c=l==null?void 0:l.items)==null?void 0:c.map((n,v)=>e.jsx("div",{className:"form-item mb-2",children:e.jsx(_,{className:"w-full text-sm font-medium text-gray-600",value:n!=null&&n.alternative_name?n==null?void 0:n.alternative_name:n==null?void 0:n.name,onChange:j=>m(n==null?void 0:n.slug,j.target.value)})},v)))})}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",className:"mr-1 capitalize",onClick:()=>s(!1),children:"Cancel"}),e.jsx(r.Button,{variant:"gradient",color:"green",className:"capitalize",onClick:n=>g(n),loading:b,children:"Submit"})]})]})}function Z({deleteColumnDialog:d,setDeleteColumnDialog:s,columns:t}){const{data:l,setData:i,post:h,processing:b,errors:o,reset:x}=D({items:[]}),m=(a,c)=>{const n=a.target.checked;i(v=>n?{...v,items:[...v.items,c]}:{...v,items:v.items.filter(j=>j!==c)})},g=a=>{a.preventDefault(),h(route("table.delete.column"),{onSuccess:()=>{s(!1),x()}})};return e.jsxs(r.Dialog,{size:"xs",open:d,children:[e.jsx(r.DialogHeader,{children:"Delete Columns"}),e.jsx(r.DialogBody,{className:"max-h-[42rem] overflow-scroll",children:e.jsxs("div",{className:"form-item",children:[e.jsx("p",{className:"text-[#333] font-semibold",children:"Please select the column you want to delete."}),e.jsx("div",{className:"grid grid-cols-2",children:(t==null?void 0:t.length)>0&&t.map((a,c)=>e.jsx(F.Fragment,{children:e.jsx(r.Checkbox,{containerProps:{className:"py-3"},className:"w-5 h-5 rounded-md",label:e.jsx(r.Typography,{color:"blue-gray",className:"font-medium text-sm",children:a!=null&&a.alternative_name?a==null?void 0:a.alternative_name:a==null?void 0:a.name}),onChange:n=>{m(n,a==null?void 0:a.id)}})},c))})]})}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:()=>s(!1),children:"Cancel"}),e.jsx(r.Button,{variant:"text",color:"red",onClick:a=>g(a),children:"Delete"})]})]})}function ee({arrangeColumnDialog:d,setArrangeColumnDialog:s,columns:t}){const[l,i]=N.useState([]),[h,b]=N.useState(null),{data:o,setData:x,post:m,processing:g,errors:a,reset:c}=D({items:[]});N.useEffect(()=>{d&&i(t)},[d]);const n=(p,I)=>{b(I)},v=()=>{b(null)},j=p=>{p.preventDefault()},w=(p,I)=>{if(!h)return;const u=l.indexOf(h),C=l.indexOf(I);if(u!==-1&&C!==-1){const k=[...(f=>f.map((R,P)=>({...R,position:P+1})))(l)],[z]=k.splice(u,1);k.splice(C,0,z);const B=k.map((f,R)=>({...f,position:R+1}));i(B);const T=B.map(f=>({slug:f.slug,position:f.position}));x("items",T)}},O=p=>{p.preventDefault(),m(route("table.rearrange.column"),{onSuccess:()=>{s(!1),c()}})};return e.jsxs(r.Dialog,{open:d,size:"xs",children:[e.jsx(r.DialogHeader,{children:"Re-arrange Columns"}),e.jsxs(r.DialogBody,{className:"max-h-[42rem] overflow-scroll",children:[e.jsx("p",{className:"text-[#333] font-semibold mb-3",children:"Please drag and drop the column you want to arrange."}),e.jsx("div",{className:"draggable-wrapper border rounded-md py-2",children:(l==null?void 0:l.length)>0&&(l==null?void 0:l.map((p,I)=>e.jsx("div",{className:"text-gray-600 font-medium py-1 px-2 text-sm  cursor-move",draggable:"true",onDragStart:u=>n(u,p),onDragEnd:v,onDragOver:j,onDrop:u=>w(u,p),children:e.jsxs("div",{className:"flex items-center gap-3 border py-2 px-2 rounded-md ",children:[e.jsx("div",{className:"icon-wrapper",children:e.jsx(q,{strokeWidth:1.5,size:18})}),p!=null&&p.alternative_name?p==null?void 0:p.alternative_name:p.name]})},I)))})]}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",className:"mr-1 capitalize",onClick:()=>s(!1),children:"cancel"}),e.jsx(r.Button,{variant:"gradient",color:"green",className:"capitalize",onClick:p=>O(p),loading:g,children:"Submit"})]})]})}function se({columns:d}){const[s,t]=N.useState(!1),[l,i]=N.useState(!1),[h,b]=N.useState(!1),[o,x]=N.useState(!1),[m,g]=N.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(r.Menu,{children:[e.jsx(r.MenuHandler,{children:e.jsx(r.Button,{variant:"gradient",size:"sm",className:"capitalize",children:"Column Options"})}),e.jsxs(r.MenuList,{className:"font-semibold text-gray-600",children:[e.jsx(r.MenuItem,{onClick:()=>{t(!0)},children:"Add Column"}),e.jsx(r.MenuItem,{onClick:()=>{i(!0)},children:"Show/Hide Columns"}),e.jsx(r.MenuItem,{onClick:()=>{b(!0)},children:"Rename Columns"}),e.jsx(r.MenuItem,{onClick:()=>{g(!0)},children:"Rearrange Columns"}),e.jsx(r.MenuItem,{className:"text-red-500",onClick:()=>{x(!0)},children:"Delete Columns"})]})]}),e.jsx(K,{addColumnDialog:s,setAddColumnDialog:t}),e.jsx(Q,{columns:d,hideColumnDialog:l,setHideColumnDialog:i}),e.jsx(X,{renameColumnDialog:h,setRenameColumnDialog:b,columns:d}),e.jsx(Z,{deleteColumnDialog:o,setDeleteColumnDialog:x,columns:d}),e.jsx(ee,{arrangeColumnDialog:m,setArrangeColumnDialog:g,columns:d})]})}function re({entity_id:d}){const{post:s,processing:t,reset:l}=D({entity_id:d}),i=()=>{d&&s(route("table.restore.column"),{preserveScroll:!0,onSuccess:()=>{l()}})};return e.jsx("div",{className:"restore-table",children:e.jsx(r.Button,{variant:"gradient",size:"sm",className:"capitalize",loading:t,onClick:i,children:"Restore Table"})})}function ue({auth:d,entity:s}){var i,h,b;const{role:t}=d;function l(o,x){for(let m=0;m<o.length;m++)if(x in o[m])return o[m][x];return""}return e.jsxs($,{user:d==null?void 0:d.user,children:[e.jsx(A,{title:s==null?void 0:s.title}),e.jsx("div",{className:"top-section p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"",children:[e.jsx(r.Typography,{variant:"h3",className:"tracking-tight",children:s==null?void 0:s.title}),e.jsxs("ul",{className:"flex gap-1 text-gray-600 text-sm",children:[e.jsx("li",{children:e.jsx(E,{href:route("dashboard"),children:"Dashboard"})}),e.jsx("li",{children:"/"}),e.jsx("li",{children:e.jsx(E,{href:route("view.table.item",s==null?void 0:s.slug),children:s==null?void 0:s.title})})]})]})})}),(s==null?void 0:s.attributes.length)===0&&e.jsxs("div",{className:"text-center border rounded py-6",children:[e.jsx(r.Typography,{variant:"h4",color:"blue-gray",className:"mb-3",children:"It seems you haven't created any columns yet."}),e.jsx(E,{href:route("table.wizard.column.index",s==null?void 0:s.id),children:e.jsx(r.Button,{variant:"gradient",size:"sm",className:"capitalize",children:"Create Column"})})]}),(s==null?void 0:s.attributes.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"filter-wrapper md:px-4",children:e.jsxs("div",{className:"flex filter-details justify-end gap-2",children:[e.jsxs("div",{className:"search-wrapper w-1/6 flex relative",children:[e.jsx(_,{placeholder:"Search...",className:"w-full text-sm rounded-md rounded-r-none border-r-0 focus:ring-0 h-8"}),e.jsx("div",{className:"search-icon",children:e.jsx(r.IconButton,{size:"sm",className:"rounded-l-none",children:e.jsx(U,{color:"white",size:18})})})]}),t==="super-admin"&&e.jsxs(F.Fragment,{children:[e.jsx(G,{columns:s==null?void 0:s.attributes}),e.jsx(se,{columns:s==null?void 0:s.attributes}),e.jsx(re,{entity_id:s==null?void 0:s.id})]})]})}),e.jsx("div",{className:"content mt-6",children:e.jsx(r.Card,{className:"h-full w-full rounded-none",children:e.jsx("div",{className:"overflow-x-auto overflow-hidden",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[(i=s==null?void 0:s.attributes)==null?void 0:i.map((o,x)=>e.jsx("th",{className:`border-y border-blue-gray-100 bg-blue-gray-50/50 p-2 border-l cursor-pointer ${o!=null&&o.hidden?"hidden":""}`,children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(r.Typography,{variant:"small",className:"leading-none text-gray-800 font-medium text-sm",children:o!=null&&o.alternative_name?o==null?void 0:o.alternative_name:o.name}),(o==null?void 0:o.sortable)&&e.jsxs("div",{className:"relative mt-1",children:[e.jsx("span",{className:"absolute -top-2 right-0 hover:bg-blue-gray-100 rounded-sm",children:e.jsx(J,{size:12,strokeWidth:2,onClick:()=>{sortData(o.slug,"asc")}})}),e.jsx("span",{className:"absolute -bottom-1 right-0 hover:bg-blue-gray-100 rounded-sm",children:e.jsx(L,{size:12,strokeWidth:2,onClick:()=>{sortData(o.slug,"desc")}})})]})]})},x)),e.jsx("th",{className:"border-y border-blue-gray-100 bg-blue-gray-50/50 p-2 border-l cursor-pointer"})]})}),e.jsx("tbody",{children:((h=s==null?void 0:s.values)==null?void 0:h.length)>0&&((b=s==null?void 0:s.values)==null?void 0:b.map((o,x)=>{var g;const m=JSON.parse(o==null?void 0:o.values);return e.jsxs("tr",{className:"even:bg-blue-gray-50/50",children:[(g=s==null?void 0:s.attributes)==null?void 0:g.map((a,c)=>e.jsx("td",{className:`border-l h-10 text-[12px] font-medium ps-2 ${a!=null&&a.hidden?"hidden":""}`,children:l(m,a.slug)},c)),e.jsx("td",{className:"border-l h-10 text-[12px] font-medium ps-2"})]},x)}))})]})})})})]})]})}export{ue as default};
